<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Git命令指南</title>
    <url>/posts/3267.html</url>
    <content><![CDATA[<h2 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h2><table>
<thead>
<tr>
<th align="center">命令</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">git init</td>
<td align="center">在当前目录下初始化一个新的Git仓库</td>
</tr>
<tr>
<td align="center">git clone &lt;远程仓库&gt;</td>
<td align="center">从远程仓库克隆一个新的本地仓库</td>
</tr>
<tr>
<td align="center">git add &lt;文件名&gt;</td>
<td align="center">将工作区的修改添加到暂存区</td>
</tr>
<tr>
<td align="center">git commit -m “&lt;提交说明&gt;”</td>
<td align="center">将暂存区的内容提交到本地仓库,并附上提交说明</td>
</tr>
<tr>
<td align="center">git status</td>
<td align="center">显示工作区和暂存区的状态</td>
</tr>
<tr>
<td align="center">git log</td>
<td align="center">查看仓库的提交历史记录</td>
</tr>
<tr>
<td align="center">git diff</td>
<td align="center">显示工作区与暂存区的差异或两个提交之间的差异</td>
</tr>
<tr>
<td align="center">git branch</td>
<td align="center">列出本地分支</td>
</tr>
<tr>
<td align="center">git branch &lt;分支名&gt;</td>
<td align="center">创建一个新分支</td>
</tr>
<tr>
<td align="center">git branch -d &lt;分支名&gt;</td>
<td align="center">删除指定的本地分支(仅删除已经被合并的分支)</td>
</tr>
<tr>
<td align="center">git branch -D &lt;分支名&gt;</td>
<td align="center">强制删除指定的本地分支(即使未被合并)</td>
</tr>
<tr>
<td align="center">git checkout &lt;分支名&gt;</td>
<td align="center">切换到指定分支</td>
</tr>
<tr>
<td align="center">git merge &lt;分支名&gt;</td>
<td align="center">将指定分支的代码合并到当前分支</td>
</tr>
<tr>
<td align="center">git pull</td>
<td align="center">拉取远程仓库最新代码到本地分支</td>
</tr>
<tr>
<td align="center">git push</td>
<td align="center">将本地分支的代码推送到远程仓库</td>
</tr>
<tr>
<td align="center">git push &lt;远程仓库&gt; &lt;分支&gt;</td>
<td align="center">将本地分支的代码推送到远程仓库</td>
</tr>
<tr>
<td align="center">git remote</td>
<td align="center">显示远程仓库列表</td>
</tr>
<tr>
<td align="center">git remote add &lt;名称&gt; &lt;远程仓库&gt;</td>
<td align="center">添加一个远程仓库到当前仓库</td>
</tr>
<tr>
<td align="center">git remote -v</td>
<td align="center">显示所有远程仓库及其URL</td>
</tr>
<tr>
<td align="center">git remote set-url origin &lt;远程仓库&gt;</td>
<td align="center">修改远程仓库的URL</td>
</tr>
<tr>
<td align="center">git remote remove &lt;仓库名称&gt;</td>
<td align="center">删除指定的远程仓库</td>
</tr>
<tr>
<td align="center">git tag</td>
<td align="center">列出仓库的标签</td>
</tr>
<tr>
<td align="center">git tag -a &lt;标签名&gt; -m “&lt;标签说明&gt;”</td>
<td align="center">创建带有说明的标签</td>
</tr>
<tr>
<td align="center">git tag -d &lt;标签名&gt;</td>
<td align="center">删除指定的标签</td>
</tr>
<tr>
<td align="center">git stash</td>
<td align="center">将当前工作区的未提交修改保存到栈中,并清理工作区</td>
</tr>
<tr>
<td align="center">git stash pop</td>
<td align="center">应用最近一次stash的内容并从栈中移除</td>
</tr>
<tr>
<td align="center">git rebase &lt;分支名&gt;</td>
<td align="center">将当前分支的提交重新应用到指定分支上</td>
</tr>
<tr>
<td align="center">git cherry-pick &lt;提交ID&gt;</td>
<td align="center">将指定的提交应用到当前分支</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>命令指南</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker快速入门</title>
    <url>/posts/2763.html</url>
    <content><![CDATA[<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><blockquote>
<p>PS:本文基于CentOS 7进行安装</p>
</blockquote>
<h4 id="卸载旧版本"><a href="#卸载旧版本" class="headerlink" title="卸载旧版本"></a>卸载旧版本</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">      docker-client \</span><br><span class="line">      docker-client-latest \</span><br><span class="line">      docker-common \</span><br><span class="line">      docker-latest \</span><br><span class="line">      docker-latest-logrotate \</span><br><span class="line">      docker-logrotate \</span><br><span class="line">      docker-engine</span><br></pre></td></tr></table></figure>

<h4 id="yum安装gcc相关"><a href="#yum安装gcc相关" class="headerlink" title="yum安装gcc相关"></a>yum安装gcc相关</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum -y install gcc</span><br><span class="line"></span><br><span class="line">sudo yum -y install gcc-c++</span><br></pre></td></tr></table></figure>

<h4 id="安装需要的软件包"><a href="#安装需要的软件包" class="headerlink" title="安装需要的软件包"></a>安装需要的软件包</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum install -y yum-utils</span><br><span class="line"></span><br><span class="line">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<h4 id="更新yum软件包索引"><a href="#更新yum软件包索引" class="headerlink" title="更新yum软件包索引"></a>更新yum软件包索引</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum makecache fast</span><br></pre></td></tr></table></figure>

<h4 id="安装docker-ce"><a href="#安装docker-ce" class="headerlink" title="安装docker ce"></a>安装docker ce</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum -y install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br></pre></td></tr></table></figure>

<h4 id="容器镜像加速"><a href="#容器镜像加速" class="headerlink" title="容器镜像加速"></a>容器镜像加速</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line"></span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;阿里云镜像加速&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

<h3 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker-Compose"></a>Docker-Compose</h3><p>运行以下命令可以安装Docker Compose的当前稳定版本:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo curl -L &quot;https://github.com/docker/compose/releases/download/v2.21.0/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<blockquote>
<p>要安装其他版本的Compose,请替换2.21.0为要使用的Compose版本</p>
</blockquote>
<p>将可执行权限应用于二进制文件:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果安装后命令失败可以创建指向&#x2F;usr&#x2F;bin或路径中任何其他目录的符号链接</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose</span><br></pre></td></tr></table></figure>

<p>测试安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure>

<h3 id="Registry"><a href="#Registry" class="headerlink" title="Registry"></a>Registry</h3><blockquote>
<p>访问页面: <a href="http://ip:5000/v2/_catalog">http://ip:5000/v2/_catalog</a></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d --name registry \</span><br><span class="line">      -p 5000:5000 \</span><br><span class="line">      -v /data/registry:/usr/local/registry \</span><br><span class="line">      --restart=always \</span><br><span class="line">      registry</span><br><span class="line"></span><br><span class="line">vim /etc/docker/daemon.json</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;insecure-registries&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;registry.access.redhat.com&quot;</span><span class="punctuation">,</span><span class="string">&quot;quay.io&quot;</span><span class="punctuation">,</span><span class="string">&quot;ip:5000&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;exec-opts&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;native.cgroupdriver=systemd&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;live-restore&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span></span><br></pre></td></tr></table></figure>

<h2 id="命令指南"><a href="#命令指南" class="headerlink" title="命令指南"></a>命令指南</h2><h3 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h3><h4 id="启动docker"><a href="#启动docker" class="headerlink" title="启动docker"></a>启动docker</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>

<h4 id="关闭docker"><a href="#关闭docker" class="headerlink" title="关闭docker"></a>关闭docker</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl stop docker</span><br></pre></td></tr></table></figure>

<h4 id="重启docker"><a href="#重启docker" class="headerlink" title="重启docker"></a>重启docker</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<h4 id="自启docker"><a href="#自启docker" class="headerlink" title="自启docker"></a>自启docker</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl enable docker</span><br></pre></td></tr></table></figure>

<h3 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h3><h4 id="在仓库搜索镜像"><a href="#在仓库搜索镜像" class="headerlink" title="在仓库搜索镜像"></a>在仓库搜索镜像</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker search [OPTIONS] &lt;search_term&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-f</code>:根据指定的过滤条件进行搜索</li>
<li><code>--format</code>:指定输出的格式</li>
<li><code>--limit</code>:限制搜索结果的数量</li>
<li><code>--no-trunc</code>:显示完整的镜像描述</li>
<li><code>--stars</code>:根据指定的星级评分筛选搜索结果</li>
</ul>
<h4 id="下载指定的镜像"><a href="#下载指定的镜像" class="headerlink" title="下载指定的镜像"></a>下载指定的镜像</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull [OPTIONS] &lt;image_name&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-a</code>:拉取指定镜像名称的所有标签</li>
<li><code>-q</code>:只显示拉取的镜像 ID</li>
<li><code>--disable-content-trust</code>:禁用内容信任验证</li>
</ul>
<h4 id="将本地的镜像推送到镜像仓库"><a href="#将本地的镜像推送到镜像仓库" class="headerlink" title="将本地的镜像推送到镜像仓库"></a>将本地的镜像推送到镜像仓库</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker push [OPTIONS] &lt;repository_address&gt;/&lt;namespace&gt;/&lt;image_name&gt;:&lt;tag&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-q</code>:只显示推送的镜像 ID</li>
<li><code>--tls</code>:与仓库建立 TLS 连接</li>
<li><code>--all-tags</code>:同时推送镜像的所有标签</li>
<li><code>--disable-content-trust</code>:禁用内容信任验证</li>
</ul>
<h4 id="列出本地上的所有镜像"><a href="#列出本地上的所有镜像" class="headerlink" title="列出本地上的所有镜像"></a>列出本地上的所有镜像</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker images [OPTIONS] [REPOSITORY[:TAG]]</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-a</code>:显示所有镜像,包括中间层镜像</li>
<li><code>-q</code>:只显示镜像的 ID</li>
<li><code>--no-trunc</code>:显示完整的镜像 ID</li>
<li><code>--digests</code>:显示镜像的摘要信息</li>
<li><code>--filter</code>:根据指定的条件过滤镜像</li>
<li><code>--format</code>:指定输出的格式</li>
<li><code>REPOSITORY</code>:指定仓库名称</li>
<li><code>TAG</code>:指定镜像的标签</li>
</ul>
<h4 id="删除指定的本地镜像"><a href="#删除指定的本地镜像" class="headerlink" title="删除指定的本地镜像"></a>删除指定的本地镜像</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker rmi [OPTIONS] &lt;image_name&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-f</code>:强制删除镜像</li>
<li><code>-q</code>:只显示被删除的镜像 ID</li>
<li><code>--no-prune</code>:不自动删除与镜像关联的未被使用的中间层镜像</li>
</ul>
<h4 id="构建一个新的镜像"><a href="#构建一个新的镜像" class="headerlink" title="构建一个新的镜像"></a>构建一个新的镜像</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker build [OPTIONS] &lt;path_to_dockerfile&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-t</code>:为镜像指定标签</li>
<li><code>-f</code>:指定要使用的 Dockerfile 路径</li>
<li><code>-q</code>:只显示构建过程中生成的镜像 ID</li>
<li><code>--build-arg &lt;variable=value&gt;</code>:为构建过程中的 ARG 指令传递变量和值</li>
</ul>
<h4 id="为现有的本地镜像添加一个新的标签"><a href="#为现有的本地镜像添加一个新的标签" class="headerlink" title="为现有的本地镜像添加一个新的标签"></a>为现有的本地镜像添加一个新的标签</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker tag &lt;image_name&gt; &lt;new_image_name&gt;</span><br></pre></td></tr></table></figure>

<h4 id="显示指定镜像的历史记录"><a href="#显示指定镜像的历史记录" class="headerlink" title="显示指定镜像的历史记录"></a>显示指定镜像的历史记录</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker history [OPTIONS] &lt;image_name&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>--format</code>:指定输出的格式</li>
<li><code>--human</code>:以人类可读的格式显示文件大小</li>
<li><code>--no-trunc</code>:显示完整的命令和结果</li>
</ul>
<h4 id="将指定的镜像保存到一个tar文件中"><a href="#将指定的镜像保存到一个tar文件中" class="headerlink" title="将指定的镜像保存到一个tar文件中"></a>将指定的镜像保存到一个tar文件中</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker save &lt;image_name&gt; -o &lt;output_file.tar&gt;</span><br></pre></td></tr></table></figure>

<h4 id="从一个tar文件中加载一个镜像"><a href="#从一个tar文件中加载一个镜像" class="headerlink" title="从一个tar文件中加载一个镜像"></a>从一个tar文件中加载一个镜像</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker load -i &lt;input_file.tar&gt;</span><br></pre></td></tr></table></figure>

<h3 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h3><h4 id="创建并运行一个新容器"><a href="#创建并运行一个新容器" class="headerlink" title="创建并运行一个新容器"></a>创建并运行一个新容器</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-d</code>:在后台以守护进程方式运行容器</li>
<li><code>-p</code>:将容器的端口映射到主机的端口</li>
<li><code>-v</code>:挂载主机目录或数据卷到容器</li>
<li><code>-e</code>:设置环境变量</li>
<li><code>-it</code>:以交互模式运行容器,并分配一个伪终端</li>
<li><code>--rm</code>:当容器退出时自动删除容器</li>
<li><code>--name</code>:为容器指定一个名称</li>
<li><code>--network</code>:指定容器连接的网络模式</li>
</ul>
<h4 id="启动一个已创建的容器"><a href="#启动一个已创建的容器" class="headerlink" title="启动一个已创建的容器"></a>启动一个已创建的容器</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker start [OPTIONS] &lt;container_id&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-a</code>:将标准输入(STDIN)、标准输出(STDOUT)和标准错误输出(STDERR)与容器进行关联</li>
<li><code>-it</code>:以交互模式运行容器,并分配一个伪终端</li>
</ul>
<h4 id="停止一个正在运行的容器"><a href="#停止一个正在运行的容器" class="headerlink" title="停止一个正在运行的容器"></a>停止一个正在运行的容器</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker stop [OPTIONS] &lt;container_id&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-t</code>:指定停止容器前等待的时间(默认 10s)</li>
</ul>
<h4 id="重启一个容器"><a href="#重启一个容器" class="headerlink" title="重启一个容器"></a>重启一个容器</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker restart [OPTIONS] &lt;container_id&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-t</code>:指定停止容器前等待的时间(默认 10s)</li>
<li><code>-s</code>:指定用于关闭容器的信号</li>
<li><code>--time-format=&quot;&lt;time_format&gt;&quot;</code>:指定等待时间的格式</li>
</ul>
<h4 id="删除一个停止的容器"><a href="#删除一个停止的容器" class="headerlink" title="删除一个停止的容器"></a>删除一个停止的容器</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker rm [OPTIONS] &lt;container_id&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-f</code>:强制删除运行中的容器</li>
<li><code>-v</code>:删除关联的卷</li>
<li><code>-l</code>:删除容器与其他容器的链接</li>
</ul>
<h4 id="列出正在运行的容器"><a href="#列出正在运行的容器" class="headerlink" title="列出正在运行的容器"></a>列出正在运行的容器</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker ps [OPTIONS]</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-a</code>:显示所有容器,包括已停止的容器</li>
<li><code>-q</code>:只显示容器的 ID</li>
</ul>
<h4 id="查看容器的日志"><a href="#查看容器的日志" class="headerlink" title="查看容器的日志"></a>查看容器的日志</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker logs [OPTIONS] &lt;container_id&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-f</code>:实时跟踪容器日志的输出</li>
<li><code>-t</code>:在日志中显示时间戳</li>
<li><code>--tail</code>:仅显示最后几行的日志</li>
<li><code>--details</code>:显示更详细的日志输出</li>
</ul>
<h4 id="在正在运行的容器中执行命令"><a href="#在正在运行的容器中执行命令" class="headerlink" title="在正在运行的容器中执行命令"></a>在正在运行的容器中执行命令</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker exec [OPTIONS] &lt;container_id&gt; &lt;command&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-i</code>:以交互模式运行容器,并分配一个伪终端</li>
<li><code>-t</code>:分配一个伪终端</li>
</ul>
<h4 id="检查容器的详细信息"><a href="#检查容器的详细信息" class="headerlink" title="检查容器的详细信息"></a>检查容器的详细信息</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker inspect [OPTIONS] &lt;container_id&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-f</code>:指定输出的格式</li>
<li><code>--type</code>:指定要检查的对象类型</li>
<li><code>--size</code>:显示相关对象的大小信息</li>
</ul>
<h3 id="数据卷命令"><a href="#数据卷命令" class="headerlink" title="数据卷命令"></a>数据卷命令</h3><h4 id="创建一个数据卷"><a href="#创建一个数据卷" class="headerlink" title="创建一个数据卷"></a>创建一个数据卷</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker volume create &lt;volume_name&gt;</span><br></pre></td></tr></table></figure>

<h4 id="列出所有数据卷"><a href="#列出所有数据卷" class="headerlink" title="列出所有数据卷"></a>列出所有数据卷</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker volume ls</span><br></pre></td></tr></table></figure>

<h4 id="查看特定数据卷的详细信息"><a href="#查看特定数据卷的详细信息" class="headerlink" title="查看特定数据卷的详细信息"></a>查看特定数据卷的详细信息</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker volume inspect &lt;volume_name&gt;</span><br></pre></td></tr></table></figure>

<h4 id="删除一个数据卷"><a href="#删除一个数据卷" class="headerlink" title="删除一个数据卷"></a>删除一个数据卷</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker volume rm &lt;volume_name&gt;</span><br></pre></td></tr></table></figure>

<h4 id="删除未使用的数据卷"><a href="#删除未使用的数据卷" class="headerlink" title="删除未使用的数据卷"></a>删除未使用的数据卷</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker volume prune</span><br></pre></td></tr></table></figure>

<h4 id="将数据卷绑定到容器的指定路径"><a href="#将数据卷绑定到容器的指定路径" class="headerlink" title="将数据卷绑定到容器的指定路径"></a>将数据卷绑定到容器的指定路径</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -v &lt;volume_name&gt;:&lt;container_path&gt;</span><br></pre></td></tr></table></figure>

<h4 id="将本地路径挂载为数据卷"><a href="#将本地路径挂载为数据卷" class="headerlink" title="将本地路径挂载为数据卷"></a>将本地路径挂载为数据卷</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -v &lt;host_path&gt;:&lt;container_path&gt;</span><br></pre></td></tr></table></figure>

<h4 id="将数据卷复制到本地路径"><a href="#将数据卷复制到本地路径" class="headerlink" title="将数据卷复制到本地路径"></a>将数据卷复制到本地路径</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -v &lt;volume_name&gt;:/&lt;container_path&gt; -v &lt;host_path&gt;:&lt;container_path&gt;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>命令指南</tag>
        <tag>Docker</tag>
        <tag>快速入门</tag>
      </tags>
  </entry>
  <entry>
    <title>MyBatis拦截器自动填充字段</title>
    <url>/posts/21450.html</url>
    <content><![CDATA[<blockquote>
<p>PS:在使用MyBatis的时候,需要对数据表里的更新时间和创建时间进行填充,但是每次手动写太过于麻烦,于是我们可以用MyBatis里的拦截器进行操作,实现自动填充</p>
</blockquote>
<h2 id="自定义注解"><a href="#自定义注解" class="headerlink" title="自定义注解"></a>自定义注解</h2><h3 id="CreatedAt"><a href="#CreatedAt" class="headerlink" title="CreatedAt"></a>CreatedAt</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> CreatedAt &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="UpdatedAt"><a href="#UpdatedAt" class="headerlink" title="UpdatedAt"></a>UpdatedAt</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> UpdatedAt &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Intercepts(&#123;@Signature(type = Executor.class, method = &quot;update&quot;, args = &#123;MappedStatement.class, Object.class&#125;)&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoTimestampInterceptor</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        Object[] args = invocation.getArgs();</span><br><span class="line">        <span class="type">MappedStatement</span> <span class="variable">ms</span> <span class="operator">=</span> (MappedStatement) args[<span class="number">0</span>];</span><br><span class="line">        <span class="type">SqlCommandType</span> <span class="variable">sqlCommandType</span> <span class="operator">=</span> ms.getSqlCommandType();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">parameter</span> <span class="operator">=</span> args[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (parameter != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (sqlCommandType == SqlCommandType.INSERT) &#123;</span><br><span class="line">                fillCreatedAt(parameter);</span><br><span class="line">                fillUpdatedAt(parameter);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sqlCommandType == SqlCommandType.UPDATE) &#123;</span><br><span class="line">                fillUpdatedAt(parameter);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> invocation.proceed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">fillCreatedAt</span><span class="params">(Object parameter)</span> <span class="keyword">throws</span> IllegalAccessException &#123;</span><br><span class="line">        Field[] fields = parameter.getClass().getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">            <span class="keyword">if</span> (field.isAnnotationPresent(CreatedAt.class)) &#123;</span><br><span class="line">                field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                <span class="keyword">if</span> (field.get(parameter) == <span class="literal">null</span>) &#123;</span><br><span class="line">                    field.set(parameter, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">fillUpdatedAt</span><span class="params">(Object parameter)</span> <span class="keyword">throws</span> IllegalAccessException &#123;</span><br><span class="line">        Field[] fields = parameter.getClass().getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">            <span class="keyword">if</span> (field.isAnnotationPresent(UpdatedAt.class)) &#123;</span><br><span class="line">                field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                field.set(parameter, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建时间</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@CreatedAt</span></span><br><span class="line"><span class="keyword">private</span> Date createdAt;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新时间</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@UpdatedAt</span></span><br><span class="line"><span class="keyword">private</span> Date updatedAt;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;register&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    INSERT INTO user</span><br><span class="line">        (id, account, password, name, avatar, created_at, updated_at)</span><br><span class="line">    VALUES (#&#123;id&#125;, #&#123;account&#125;, #&#123;password&#125;, #&#123;name&#125;, #&#123;avatar&#125;, #&#123;createdAt&#125;, #&#123;updatedAt&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>MyBatis</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>MyBatis</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot全局异常处理</title>
    <url>/posts/48133.html</url>
    <content><![CDATA[<h2 id="自定义异常类"><a href="#自定义异常类" class="headerlink" title="自定义异常类"></a>自定义异常类</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CustomException</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CustomException</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(msg);</span><br><span class="line">        <span class="built_in">this</span>.code = ResultCodeEnum.SYSTEM_ERROR.getCode();</span><br><span class="line">        <span class="built_in">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CustomException</span><span class="params">(ResultCodeEnum resultCode)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(resultCode.getMsg());</span><br><span class="line">        <span class="built_in">this</span>.code = resultCode.getCode();</span><br><span class="line">        <span class="built_in">this</span>.msg = resultCode.getMsg();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CustomException</span><span class="params">(ResultCodeEnum resultCode, Throwable cause)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(resultCode.getMsg(), cause);</span><br><span class="line">        <span class="built_in">this</span>.code = resultCode.getCode();</span><br><span class="line">        <span class="built_in">this</span>.msg = resultCode.getMsg();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="全局异常处理器"><a href="#全局异常处理器" class="headerlink" title="全局异常处理器"></a>全局异常处理器</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> LoggerFactory.getLogger(GlobalExceptionHandler.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = CustomException.class)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">CustomExceptionHandler</span><span class="params">(CustomException e)</span> &#123;</span><br><span class="line">        LOGGER.error(<span class="string">&quot;CustomException:&#123;&#125;&quot;</span>, e.getMsg());</span><br><span class="line">        <span class="keyword">return</span> Result.fail(ResultCodeEnum.SYSTEM_ERROR, e.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">ExceptionHandler</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">        LOGGER.error(<span class="string">&quot;Exception:&#123;&#125;&quot;</span>, e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> Result.fail(ResultCodeEnum.SYSTEM_ERROR, e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
        <tag>Handler</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker安装中间件</title>
    <url>/posts/41876.html</url>
    <content><![CDATA[<h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><h3 id="创建挂载的目录"><a href="#创建挂载的目录" class="headerlink" title="创建挂载的目录"></a>创建挂载的目录</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p /data/mysql/&#123;data,logs,conf&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建挂载的配置文件"><a href="#创建挂载的配置文件" class="headerlink" title="创建挂载的配置文件"></a>创建挂载的配置文件</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /data/mysql/conf/my.cnf</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">user=mysql</span><br><span class="line">port=3306</span><br><span class="line">bind-address=0.0.0.0</span><br><span class="line"></span><br><span class="line">#日志设置</span><br><span class="line">log-error=/var/log/mysql/error.log</span><br><span class="line">log_timestamps=SYSTEM</span><br><span class="line"></span><br><span class="line">#慢查询日志设置</span><br><span class="line">slow_query_log=1</span><br><span class="line">slow_query_log_file=/var/log/mysql/slow.log</span><br><span class="line">long_query_time=2</span><br><span class="line"></span><br><span class="line">#存储引擎设置</span><br><span class="line">default-storage-engine=InnoDB</span><br><span class="line"></span><br><span class="line">#InnoDB设置</span><br><span class="line">innodb_buffer_pool_size=1G</span><br><span class="line">innodb_log_file_size=256M</span><br><span class="line">innodb_flush_log_at_trx_commit=1</span><br><span class="line">innodb_flush_method=O_DIRECT</span><br><span class="line"></span><br><span class="line">#字符集和排序规则</span><br><span class="line">character-set-server=utf8mb4</span><br><span class="line">collation-server=utf8mb4_unicode_ci</span><br><span class="line"></span><br><span class="line">#严格模式和SQL模式设置</span><br><span class="line">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8mb4</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">default-character-set=utf8mb4</span><br></pre></td></tr></table></figure>

<h3 id="创建docker-compose-yml"><a href="#创建docker-compose-yml" class="headerlink" title="创建docker-compose.yml"></a>创建docker-compose.yml</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /data/mysql/docker-compose.yml</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">mysql:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">mysql:8.0.34</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">MYSQL_ROOT_PASSWORD=root</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/mysql/conf:/etc/mysql/conf.d</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/mysql/logs:/var/log/mysql</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/mysql/data:/var/lib/mysql</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="number">3306</span><span class="string">:3306</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">mysql</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">mysql</span></span><br></pre></td></tr></table></figure>

<h3 id="启动容器"><a href="#启动容器" class="headerlink" title="启动容器"></a>启动容器</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><h3 id="创建挂载的目录-1"><a href="#创建挂载的目录-1" class="headerlink" title="创建挂载的目录"></a>创建挂载的目录</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p /data/redis/&#123;data,conf&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建挂载的配置文件-1"><a href="#创建挂载的配置文件-1" class="headerlink" title="创建挂载的配置文件"></a>创建挂载的配置文件</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /data/redis/conf/redis.conf</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#设置Redis运行的模式(非保护模式)</span><br><span class="line">protected-mode no</span><br><span class="line"></span><br><span class="line">#监听的端口号</span><br><span class="line">port 6379</span><br><span class="line"></span><br><span class="line">#TCP连接队列的最大长度</span><br><span class="line">tcp-backlog 511</span><br><span class="line"></span><br><span class="line">#设置连接密码</span><br><span class="line">requirepass root</span><br><span class="line"></span><br><span class="line">#客户端空闲多长时间后关闭连接</span><br><span class="line">timeout 0</span><br><span class="line"></span><br><span class="line">#TCP连接的保活时间</span><br><span class="line">tcp-keepalive 300</span><br><span class="line"></span><br><span class="line">#是否在后台运行(不建议在生产环境使用)</span><br><span class="line">daemonize no</span><br><span class="line"></span><br><span class="line">#监督模式(不启用)</span><br><span class="line">supervised no</span><br><span class="line"></span><br><span class="line">#存放进程ID的文件路径</span><br><span class="line">pidfile /var/run/redis_6379.pid</span><br><span class="line"></span><br><span class="line">#日志级别</span><br><span class="line">loglevel notice</span><br><span class="line"></span><br><span class="line">#日志文件路径(为空表示不写日志文件)</span><br><span class="line">logfile &quot;&quot;</span><br><span class="line"></span><br><span class="line">#数据库数量</span><br><span class="line">databases 30</span><br><span class="line"></span><br><span class="line">#是否总是显示Redis的Logo</span><br><span class="line">always-show-logo yes</span><br><span class="line"></span><br><span class="line">#持久化配置</span><br><span class="line">#在指定时间内,如果指定数量的键被修改,执行一次保存操作</span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"></span><br><span class="line">#如果在执行Bgsave(后台保存)时出错,停止写入操作</span><br><span class="line">stop-writes-on-bgsave-error yes</span><br><span class="line"></span><br><span class="line">#是否启用RDB压缩</span><br><span class="line">rdbcompression yes</span><br><span class="line"></span><br><span class="line">#是否在RDB文件中添加校验和</span><br><span class="line">rdbchecksum yes</span><br><span class="line"></span><br><span class="line">#RDB文件的名称</span><br><span class="line">dbfilename dump.rdb</span><br><span class="line"></span><br><span class="line">#RDB文件的存储目录</span><br><span class="line">dir ./</span><br><span class="line"></span><br><span class="line">#从节点是否提供过期的键</span><br><span class="line">replica-serve-stale-data yes</span><br><span class="line"></span><br><span class="line">#从节点是否只读</span><br><span class="line">replica-read-only yes</span><br><span class="line"></span><br><span class="line">#是否启用无盘同步</span><br><span class="line">repl-diskless-sync no</span><br><span class="line"></span><br><span class="line">#是否禁用TCP_NODELAY选项</span><br><span class="line">repl-disable-tcp-nodelay no</span><br><span class="line"></span><br><span class="line">#从节点优先级</span><br><span class="line">replica-priority 100</span><br><span class="line"></span><br><span class="line">#是否启用惰性删除</span><br><span class="line">lazyfree-lazy-eviction no</span><br><span class="line">lazyfree-lazy-expire no</span><br><span class="line">lazyfree-lazy-server-del no</span><br><span class="line">replica-lazy-flush no</span><br><span class="line"></span><br><span class="line">#是否开启AOF持久化</span><br><span class="line">appendonly yes</span><br><span class="line"></span><br><span class="line">#AOF文件的名称</span><br><span class="line">appendfilename &quot;appendonly.aof&quot;</span><br><span class="line"></span><br><span class="line">#在AOF重写时是否禁用文件系统同步</span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line"></span><br><span class="line">#当AOF文件大小达到总数据大小的百分之多少时,执行AOF重写</span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line"></span><br><span class="line">#当AOF文件大小达到多少时,执行AOF重写</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line"></span><br><span class="line">#是否在截断的AOF文件上加载数据</span><br><span class="line">aof-load-truncated yes</span><br><span class="line"></span><br><span class="line">#是否使用RDB文件的文件头</span><br><span class="line">aof-use-rdb-preamble yes</span><br><span class="line"></span><br><span class="line">#执行Lua脚本的时间限制</span><br><span class="line">lua-time-limit 5000</span><br><span class="line"></span><br><span class="line">#慢查询日志的最大长度</span><br><span class="line">slowlog-max-len 128</span><br><span class="line"></span><br><span class="line">#订阅通知的事件类型</span><br><span class="line">notify-keyspace-events &quot;&quot;</span><br><span class="line"></span><br><span class="line">#Hash类型数据结构的最大ziplist条目数和值大小</span><br><span class="line">hash-max-ziplist-entries 512</span><br><span class="line">hash-max-ziplist-value 64</span><br><span class="line"></span><br><span class="line">#List类型数据结构的最大ziplist大小和压缩深度</span><br><span class="line">list-max-ziplist-size -2</span><br><span class="line">list-compress-depth 0</span><br><span class="line"></span><br><span class="line">#Set类型数据结构的最大intset条目数</span><br><span class="line">set-max-intset-entries 512</span><br><span class="line"></span><br><span class="line">#Zset类型数据结构的最大ziplist条目数和值大小</span><br><span class="line">zset-max-ziplist-entries 128</span><br><span class="line">zset-max-ziplist-value 64</span><br><span class="line"></span><br><span class="line">#HyperLogLog数据结构的最大稀疏字节数</span><br><span class="line">hll-sparse-max-bytes 3000</span><br><span class="line"></span><br><span class="line">#Stream数据结构的最大节点字节数和最大节点数量</span><br><span class="line">stream-node-max-bytes 4096</span><br><span class="line">stream-node-max-entries 100</span><br><span class="line"></span><br><span class="line">#是否启用主动rehash操作</span><br><span class="line">activerehashing yes</span><br><span class="line"></span><br><span class="line">#Redis的执行频率(单位:赫兹)</span><br><span class="line">hz 10</span><br><span class="line"></span><br><span class="line">#动态调整Redis的执行频率</span><br><span class="line">dynamic-hz yes</span><br><span class="line"></span><br><span class="line">#是否在AOF重写时增量地执行文件同步</span><br><span class="line">aof-rewrite-incremental-fsync yes</span><br><span class="line"></span><br><span class="line">#是否在RDB保存时增量地执行文件同步</span><br><span class="line">rdb-save-incremental-fsync yes</span><br></pre></td></tr></table></figure>

<h3 id="创建docker-compose-yml-1"><a href="#创建docker-compose-yml-1" class="headerlink" title="创建docker-compose.yml"></a>创建docker-compose.yml</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /data/redis/docker-compose.yml</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">redis:6.0</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">&#x27;redis-server /etc/redis/redis.conf&#x27;</span></span><br><span class="line">        <span class="attr">logging:</span></span><br><span class="line">            <span class="attr">options:</span></span><br><span class="line">                <span class="attr">max-file:</span> <span class="number">2</span></span><br><span class="line">                <span class="attr">max-size:</span> <span class="string">100m</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/redis/conf/redis.conf:/etc/redis/redis.conf</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/redis/data:/data</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="number">6379</span><span class="string">:6379</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">redis</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">redis</span></span><br></pre></td></tr></table></figure>

<h3 id="启动容器-1"><a href="#启动容器-1" class="headerlink" title="启动容器"></a>启动容器</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><blockquote>
<p>访问页面: <a href="http://ip/">http://ip:80</a></p>
</blockquote>
<h3 id="创建挂载的目录-2"><a href="#创建挂载的目录-2" class="headerlink" title="创建挂载的目录"></a>创建挂载的目录</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p /data/nginx/&#123;conf,html,logs&#125;</span><br></pre></td></tr></table></figure>

<h3 id="先启动一次容器"><a href="#先启动一次容器" class="headerlink" title="先启动一次容器"></a>先启动一次容器</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d --name nginx nginx</span><br></pre></td></tr></table></figure>

<h3 id="把容器里面的内容复制出来"><a href="#把容器里面的内容复制出来" class="headerlink" title="把容器里面的内容复制出来"></a>把容器里面的内容复制出来</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker cp nginx:/etc/nginx/nginx.conf /data/nginx/conf/nginx.conf</span><br><span class="line">docker cp nginx:/etc/nginx/conf.d /data/nginx/conf/conf.d</span><br><span class="line">docker cp nginx:/usr/share/nginx/html /data/nginx</span><br><span class="line">docker cp nginx:/var/log/nginx/. /data/nginx/logs</span><br></pre></td></tr></table></figure>

<h3 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker rm -f nginx</span><br></pre></td></tr></table></figure>

<h3 id="创建docker-compose-yml-2"><a href="#创建docker-compose-yml-2" class="headerlink" title="创建docker-compose.yml"></a>创建docker-compose.yml</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /data/nginx/docker-compose.yml</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">nginx:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/nginx/html:/usr/share/nginx/html</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/nginx/logs:/var/log/nginx</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/nginx/conf/conf.d:/etc/nginx/conf.d</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/nginx/conf/nginx.conf:/etc/nginx/nginx.conf</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="number">80</span><span class="string">:80</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">nginx</span></span><br></pre></td></tr></table></figure>

<h3 id="启动容器-2"><a href="#启动容器-2" class="headerlink" title="启动容器"></a>启动容器</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<h2 id="Nacos"><a href="#Nacos" class="headerlink" title="Nacos"></a>Nacos</h2><blockquote>
<p>访问页面: <a href="http://ip:8848/nacos/index.html">http://ip:8848/nacos/index.html</a></p>
</blockquote>
<h3 id="创建挂载的目录-3"><a href="#创建挂载的目录-3" class="headerlink" title="创建挂载的目录"></a>创建挂载的目录</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p /data/nacos</span><br></pre></td></tr></table></figure>

<h3 id="先启动一次容器-1"><a href="#先启动一次容器-1" class="headerlink" title="先启动一次容器"></a>先启动一次容器</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d --name nacos nacos/nacos-server</span><br></pre></td></tr></table></figure>

<h3 id="把容器里面的内容复制出来-1"><a href="#把容器里面的内容复制出来-1" class="headerlink" title="把容器里面的内容复制出来"></a>把容器里面的内容复制出来</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker cp nacos:/home/nacos/logs /data/nacos</span><br><span class="line">docker cp nacos:/home/nacos/conf /data/nacos</span><br></pre></td></tr></table></figure>

<h3 id="删除容器-1"><a href="#删除容器-1" class="headerlink" title="删除容器"></a>删除容器</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker rm -f nacos</span><br></pre></td></tr></table></figure>

<h3 id="创建挂载的配置文件-2"><a href="#创建挂载的配置文件-2" class="headerlink" title="创建挂载的配置文件"></a>创建挂载的配置文件</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /data/nacos/conf/application.properties</span><br></pre></td></tr></table></figure>

<p>注意mysql连接地址,因为mysql的容器设置了hostname,所以这里直接用hostname的值</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">spring.datasource.platform=mysql</span><br><span class="line">db.num=1</span><br><span class="line">db.url.0=jdbc:mysql://mysql:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=30000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span><br><span class="line">db.user=root</span><br><span class="line">db.password=root</span><br></pre></td></tr></table></figure>

<h3 id="运行Sql文件"><a href="#运行Sql文件" class="headerlink" title="运行Sql文件"></a>运行Sql文件</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   数据库全名 = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   表名称 = config_info   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;content&#x27;</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;md5&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;2010-05-05 00:00:00&#x27;</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;2010-05-05 00:00:00&#x27;</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">  `src_user` text COMMENT <span class="string">&#x27;source user&#x27;</span>,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source ip&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;租户字段&#x27;</span>,</span><br><span class="line">  `c_desc` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `c_use` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `effect` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `type` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `c_schema` text,</span><br><span class="line">  `encrypted_data_key` text <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;秘钥&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configinfo_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;config_info&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   数据库全名 = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   表名称 = config_info_aggr   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info_aggr` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `datum_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;datum_id&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;内容&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;租户字段&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configinfoaggr_datagrouptenantdatum` (`data_id`,`group_id`,`tenant_id`,`datum_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;增加租户字段&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   数据库全名 = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   表名称 = config_info_beta   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info_beta` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;app_name&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;content&#x27;</span>,</span><br><span class="line">  `beta_ips` <span class="type">varchar</span>(<span class="number">1024</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;betaIps&#x27;</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;md5&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;2010-05-05 00:00:00&#x27;</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;2010-05-05 00:00:00&#x27;</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">  `src_user` text COMMENT <span class="string">&#x27;source user&#x27;</span>,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source ip&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;租户字段&#x27;</span>,</span><br><span class="line">  `encrypted_data_key` text <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;秘钥&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configinfobeta_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;config_info_beta&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   数据库全名 = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   表名称 = config_info_tag   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info_tag` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_id&#x27;</span>,</span><br><span class="line">  `tag_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tag_id&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;app_name&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;content&#x27;</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;md5&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;2010-05-05 00:00:00&#x27;</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;2010-05-05 00:00:00&#x27;</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">  `src_user` text COMMENT <span class="string">&#x27;source user&#x27;</span>,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source ip&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configinfotag_datagrouptenanttag` (`data_id`,`group_id`,`tenant_id`,`tag_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;config_info_tag&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   数据库全名 = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   表名称 = config_tags_relation   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_tags_relation` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `tag_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tag_name&#x27;</span>,</span><br><span class="line">  `tag_type` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tag_type&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_id&#x27;</span>,</span><br><span class="line">  `nid` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`nid`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configtagrelation_configidtag` (`id`,`tag_name`,`tag_type`),</span><br><span class="line">  KEY `idx_tenant_id` (`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;config_tag_relation&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   数据库全名 = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   表名称 = group_capacity   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `group_capacity` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键ID&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;Group ID,空字符表示整个集群&#x27;</span>,</span><br><span class="line">  `quota` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;配额,0表示使用默认值&#x27;</span>,</span><br><span class="line">  `usage` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;使用量&#x27;</span>,</span><br><span class="line">  `max_size` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;单个配置大小上限,单位为字节,0表示使用默认值&#x27;</span>,</span><br><span class="line">  `max_aggr_count` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;聚合子配置最大个数,,0表示使用默认值&#x27;</span>,</span><br><span class="line">  `max_aggr_size` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;单个聚合数据的子配置大小上限,单位为字节,0表示使用默认值&#x27;</span>,</span><br><span class="line">  `max_history_count` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;最大变更历史数量&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;2010-05-05 00:00:00&#x27;</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;2010-05-05 00:00:00&#x27;</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_group_id` (`group_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;集群、各Group容量信息表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   数据库全名 = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   表名称 = his_config_info   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `his_config_info` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">64</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `nid` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;app_name&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;2010-05-05 00:00:00&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;2010-05-05 00:00:00&#x27;</span>,</span><br><span class="line">  `src_user` text,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `op_type` <span class="type">char</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;租户字段&#x27;</span>,</span><br><span class="line">  `encrypted_data_key` text <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;秘钥&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`nid`),</span><br><span class="line">  KEY `idx_gmt_create` (`gmt_create`),</span><br><span class="line">  KEY `idx_gmt_modified` (`gmt_modified`),</span><br><span class="line">  KEY `idx_did` (`data_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;多租户改造&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   数据库全名 = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   表名称 = tenant_capacity   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tenant_capacity` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键ID&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;Tenant ID&#x27;</span>,</span><br><span class="line">  `quota` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;配额,0表示使用默认值&#x27;</span>,</span><br><span class="line">  `usage` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;使用量&#x27;</span>,</span><br><span class="line">  `max_size` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;单个配置大小上限,单位为字节,0表示使用默认值&#x27;</span>,</span><br><span class="line">  `max_aggr_count` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;聚合子配置最大个数&#x27;</span>,</span><br><span class="line">  `max_aggr_size` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;单个聚合数据的子配置大小上限,单位为字节,0表示使用默认值&#x27;</span>,</span><br><span class="line">  `max_history_count` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;最大变更历史数量&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;2010-05-05 00:00:00&#x27;</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;2010-05-05 00:00:00&#x27;</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_tenant_id` (`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;租户容量信息表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tenant_info` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `kp` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;kp&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_id&#x27;</span>,</span><br><span class="line">  `tenant_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_name&#x27;</span>,</span><br><span class="line">  `tenant_desc` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tenant_desc&#x27;</span>,</span><br><span class="line">  `create_source` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;create_source&#x27;</span>,</span><br><span class="line">  `gmt_create` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `gmt_modified` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_tenant_info_kptenantid` (`kp`,`tenant_id`),</span><br><span class="line">  KEY `idx_tenant_id` (`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;tenant_info&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> users (</span><br><span class="line"> username <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line"> password <span class="type">varchar</span>(<span class="number">500</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"> enabled <span class="type">boolean</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> roles (</span><br><span class="line"> username <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"> role <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"> <span class="keyword">constraint</span> uk_username_role <span class="keyword">UNIQUE</span> (username,role)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> permissions (</span><br><span class="line">    role <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    resource <span class="type">varchar</span>(<span class="number">512</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    action <span class="type">varchar</span>(<span class="number">8</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">constraint</span> uk_role_permission <span class="keyword">UNIQUE</span> (role,resource,action)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> users (username, password, enabled) <span class="keyword">VALUES</span> (<span class="string">&#x27;nacos&#x27;</span>, <span class="string">&#x27;$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu&#x27;</span>, <span class="literal">TRUE</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> roles (username, role) <span class="keyword">VALUES</span> (<span class="string">&#x27;nacos&#x27;</span>, <span class="string">&#x27;ROLE_ADMIN&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="创建docker-compose-yml-3"><a href="#创建docker-compose-yml-3" class="headerlink" title="创建docker-compose.yml"></a>创建docker-compose.yml</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /data/nacos/docker-compose.yml</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">nacos-server:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nacos/nacos-server</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">        <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">MODE=standalone</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">JVM_XMX=256m</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">JVM_XMS=256m</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/nacos/conf:/data/nacos/conf</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/nacos/logs:/data/nacos/logs</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="number">9849</span><span class="string">:9849</span></span><br><span class="line">            <span class="bullet">-</span> <span class="number">9848</span><span class="string">:9848</span></span><br><span class="line">            <span class="bullet">-</span> <span class="number">8848</span><span class="string">:8848</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">nacos</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">nacos</span></span><br></pre></td></tr></table></figure>

<h3 id="启动容器-3"><a href="#启动容器-3" class="headerlink" title="启动容器"></a>启动容器</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<h2 id="Minio"><a href="#Minio" class="headerlink" title="Minio"></a>Minio</h2><blockquote>
<p>访问页面: <a href="http://ip:9090/">http://ip:9090</a></p>
</blockquote>
<h3 id="创建挂载的目录-4"><a href="#创建挂载的目录-4" class="headerlink" title="创建挂载的目录"></a>创建挂载的目录</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p /data/minio/&#123;&#123;data,conf&#125;,data/data-&#123;1..4&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建挂载的配置文件-3"><a href="#创建挂载的配置文件-3" class="headerlink" title="创建挂载的配置文件"></a>创建挂载的配置文件</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /data/minio/conf/config.env</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#账号和密码(至少8位)</span><br><span class="line">MINIO_ROOT_USER=minioroot</span><br><span class="line">MINIO_ROOT_PASSWORD=minioroot</span><br><span class="line"></span><br><span class="line">#存储卷路径</span><br><span class="line">MINIO_VOLUMES=&quot;/data-&#123;1...4&#125;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="创建docker-compose-yml-4"><a href="#创建docker-compose-yml-4" class="headerlink" title="创建docker-compose.yml"></a>创建docker-compose.yml</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /data/minio/docker-compose.yml</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">minio:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">quay.io/minio/minio</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">&#x27;server --console-address &quot;:9090&quot;&#x27;</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">MINIO_CONFIG_ENV_FILE=/etc/config.env</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/minio/conf/config.env:/etc/config.env</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/minio/data/data-4:/data-4</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/minio/data/data-3:/data-3</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/minio/data/data-2:/data-2</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/minio/data/data-1:/data-1</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="number">9090</span><span class="string">:9090</span></span><br><span class="line">            <span class="bullet">-</span> <span class="number">9000</span><span class="string">:9000</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">minio</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">minio</span></span><br></pre></td></tr></table></figure>

<h3 id="启动容器-4"><a href="#启动容器-4" class="headerlink" title="启动容器"></a>启动容器</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<h2 id="Xxl-Job"><a href="#Xxl-Job" class="headerlink" title="Xxl-Job"></a>Xxl-Job</h2><blockquote>
<p>访问页面: <a href="http://ip:7397/xxl-job-admin">http://ip:7397/xxl-job-admin</a></p>
</blockquote>
<h3 id="创建挂载的目录-5"><a href="#创建挂载的目录-5" class="headerlink" title="创建挂载的目录"></a>创建挂载的目录</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p /data/xxl-job/logs</span><br></pre></td></tr></table></figure>

<h3 id="运行Sql文件-1"><a href="#运行Sql文件-1" class="headerlink" title="运行Sql文件"></a>运行Sql文件</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> database if <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> `xxl_job` <span class="keyword">default</span> <span class="type">character</span> <span class="keyword">set</span> utf8mb4 <span class="keyword">collate</span> utf8mb4_unicode_ci;</span><br><span class="line">use `xxl_job`;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> NAMES utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `xxl_job_info` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `job_group` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;执行器主键ID&#x27;</span>,</span><br><span class="line">  `job_desc` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `add_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `update_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `author` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;作者&#x27;</span>,</span><br><span class="line">  `alarm_email` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;报警邮件&#x27;</span>,</span><br><span class="line">  `schedule_type` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;NONE&#x27;</span> COMMENT <span class="string">&#x27;调度类型&#x27;</span>,</span><br><span class="line">  `schedule_conf` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;调度配置,值含义取决于调度类型&#x27;</span>,</span><br><span class="line">  `misfire_strategy` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;DO_NOTHING&#x27;</span> COMMENT <span class="string">&#x27;调度过期策略&#x27;</span>,</span><br><span class="line">  `executor_route_strategy` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;执行器路由策略&#x27;</span>,</span><br><span class="line">  `executor_handler` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;执行器任务handler&#x27;</span>,</span><br><span class="line">  `executor_param` <span class="type">varchar</span>(<span class="number">512</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;执行器任务参数&#x27;</span>,</span><br><span class="line">  `executor_block_strategy` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;阻塞处理策略&#x27;</span>,</span><br><span class="line">  `executor_timeout` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;任务执行超时时间,单位秒&#x27;</span>,</span><br><span class="line">  `executor_fail_retry_count` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;失败重试次数&#x27;</span>,</span><br><span class="line">  `glue_type` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;GLUE类型&#x27;</span>,</span><br><span class="line">  `glue_source` mediumtext COMMENT <span class="string">&#x27;GLUE源代码&#x27;</span>,</span><br><span class="line">  `glue_remark` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;GLUE备注&#x27;</span>,</span><br><span class="line">  `glue_updatetime` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;GLUE更新时间&#x27;</span>,</span><br><span class="line">  `child_jobid` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;子任务ID,多个逗号分隔&#x27;</span>,</span><br><span class="line">  `trigger_status` tinyint(<span class="number">4</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;调度状态:0-停止,1-运行&#x27;</span>,</span><br><span class="line">  `trigger_last_time` <span class="type">bigint</span>(<span class="number">13</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;上次调度时间&#x27;</span>,</span><br><span class="line">  `trigger_next_time` <span class="type">bigint</span>(<span class="number">13</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;下次调度时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `xxl_job_log` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `job_group` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;执行器主键ID&#x27;</span>,</span><br><span class="line">  `job_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;任务,主键ID&#x27;</span>,</span><br><span class="line">  `executor_address` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;执行器地址,本次执行的地址&#x27;</span>,</span><br><span class="line">  `executor_handler` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;执行器任务handler&#x27;</span>,</span><br><span class="line">  `executor_param` <span class="type">varchar</span>(<span class="number">512</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;执行器任务参数&#x27;</span>,</span><br><span class="line">  `executor_sharding_param` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;执行器任务分片参数,格式如 1/2&#x27;</span>,</span><br><span class="line">  `executor_fail_retry_count` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;失败重试次数&#x27;</span>,</span><br><span class="line">  `trigger_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;调度-时间&#x27;</span>,</span><br><span class="line">  `trigger_code` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;调度-结果&#x27;</span>,</span><br><span class="line">  `trigger_msg` text COMMENT <span class="string">&#x27;调度-日志&#x27;</span>,</span><br><span class="line">  `handle_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;执行-时间&#x27;</span>,</span><br><span class="line">  `handle_code` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;执行-状态&#x27;</span>,</span><br><span class="line">  `handle_msg` text COMMENT <span class="string">&#x27;执行-日志&#x27;</span>,</span><br><span class="line">  `alarm_status` tinyint(<span class="number">4</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;告警状态:0-默认、1-无需告警、2-告警成功、3-告警失败&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `I_trigger_time` (`trigger_time`),</span><br><span class="line">  KEY `I_handle_code` (`handle_code`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `xxl_job_log_report` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `trigger_day` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;调度-时间&#x27;</span>,</span><br><span class="line">  `running_count` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;运行中-日志数量&#x27;</span>,</span><br><span class="line">  `suc_count` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;执行成功-日志数量&#x27;</span>,</span><br><span class="line">  `fail_count` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;执行失败-日志数量&#x27;</span>,</span><br><span class="line">  `update_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `i_trigger_day` (`trigger_day`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `xxl_job_logglue` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `job_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;任务,主键ID&#x27;</span>,</span><br><span class="line">  `glue_type` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;GLUE类型&#x27;</span>,</span><br><span class="line">  `glue_source` mediumtext COMMENT <span class="string">&#x27;GLUE源代码&#x27;</span>,</span><br><span class="line">  `glue_remark` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;GLUE备注&#x27;</span>,</span><br><span class="line">  `add_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `update_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `xxl_job_registry` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `registry_group` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `registry_key` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `registry_value` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `update_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `i_g_k_v` (`registry_group`,`registry_key`,`registry_value`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `xxl_job_group` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;执行器AppName&#x27;</span>,</span><br><span class="line">  `title` <span class="type">varchar</span>(<span class="number">12</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;执行器名称&#x27;</span>,</span><br><span class="line">  `address_type` tinyint(<span class="number">4</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;执行器地址类型:0=自动注册、1=手动录入&#x27;</span>,</span><br><span class="line">  `address_list` text COMMENT <span class="string">&#x27;执行器地址列表,多地址逗号分隔&#x27;</span>,</span><br><span class="line">  `update_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `xxl_job_user` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;账号&#x27;</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">  `role` tinyint(<span class="number">4</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;角色:0-普通用户、1-管理员&#x27;</span>,</span><br><span class="line">  `permission` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;权限:执行器ID列表,多个逗号分割&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `i_username` (`username`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `xxl_job_lock` (</span><br><span class="line">  `lock_name` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;锁名称&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`lock_name`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `xxl_job_group`(`id`, `app_name`, `title`, `address_type`, `address_list`, `update_time`) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;xxl-job-executor-sample&#x27;</span>, <span class="string">&#x27;示例执行器&#x27;</span>, <span class="number">0</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;2018-11-03 22:21:31&#x27;</span> );</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `xxl_job_info`(`id`, `job_group`, `job_desc`, `add_time`, `update_time`, `author`, `alarm_email`, `schedule_type`, `schedule_conf`, `misfire_strategy`, `executor_route_strategy`, `executor_handler`, `executor_param`, `executor_block_strategy`, `executor_timeout`, `executor_fail_retry_count`, `glue_type`, `glue_source`, `glue_remark`, `glue_updatetime`, `child_jobid`) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">1</span>, <span class="string">&#x27;测试任务1&#x27;</span>, <span class="string">&#x27;2018-11-03 22:21:31&#x27;</span>, <span class="string">&#x27;2018-11-03 22:21:31&#x27;</span>, <span class="string">&#x27;XXL&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;CRON&#x27;</span>, <span class="string">&#x27;0 0 0 * * ? *&#x27;</span>, <span class="string">&#x27;DO_NOTHING&#x27;</span>, <span class="string">&#x27;FIRST&#x27;</span>, <span class="string">&#x27;demoJobHandler&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;SERIAL_EXECUTION&#x27;</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="string">&#x27;BEAN&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;GLUE代码初始化&#x27;</span>, <span class="string">&#x27;2018-11-03 22:21:31&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `xxl_job_user`(`id`, `username`, `password`, `role`, `permission`) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;e10adc3949ba59abbe56e057f20f883e&#x27;</span>, <span class="number">1</span>, <span class="keyword">NULL</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `xxl_job_lock` ( `lock_name`) <span class="keyword">VALUES</span> ( <span class="string">&#x27;schedule_lock&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>

<h3 id="创建docker-compose-yml-5"><a href="#创建docker-compose-yml-5" class="headerlink" title="创建docker-compose.yml"></a>创建docker-compose.yml</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /data/xxl-job/docker-compose.yml</span><br></pre></td></tr></table></figure>

<p>记得修改mysql的连接地址,accessToken的默认值就是default_token,当然也可以对其进行修改</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">xxl-job-admin:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">xuxueli/xxl-job-admin:2.4.0</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">PARAMS=--spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver</span> <span class="string">--spring.datasource.url=jdbc:mysql://ip:3306/xxl_job?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai</span> <span class="string">--spring.datasource.username=root</span> <span class="string">--spring.datasource.password=root</span> <span class="string">--xxl.job.accessToken=default_token</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/xxl-job/logs:/data/applogs</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="number">7397</span><span class="string">:8080</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">xxl-job-admin</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">xxl-job-admin</span></span><br></pre></td></tr></table></figure>

<h3 id="启动容器-5"><a href="#启动容器-5" class="headerlink" title="启动容器"></a>启动容器</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<h2 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h2><blockquote>
<p>访问页面: <a href="http://ip:15672/">http://ip:15672</a></p>
</blockquote>
<h3 id="创建挂载的目录-6"><a href="#创建挂载的目录-6" class="headerlink" title="创建挂载的目录"></a>创建挂载的目录</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p /data/rabbitmq/plugins</span><br></pre></td></tr></table></figure>

<h3 id="先启动一次容器-2"><a href="#先启动一次容器-2" class="headerlink" title="先启动一次容器"></a>先启动一次容器</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d --name rabbitmq rabbitmq:3.12.12-management</span><br></pre></td></tr></table></figure>

<h3 id="把容器里面的内容复制出来-2"><a href="#把容器里面的内容复制出来-2" class="headerlink" title="把容器里面的内容复制出来"></a>把容器里面的内容复制出来</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker cp rabbitmq:/plugins/. /data/rabbitmq/plugins/</span><br></pre></td></tr></table></figure>

<h3 id="删除容器-2"><a href="#删除容器-2" class="headerlink" title="删除容器"></a>删除容器</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker rm -f rabbitmq</span><br></pre></td></tr></table></figure>

<h3 id="创建docker-compose-yml-6"><a href="#创建docker-compose-yml-6" class="headerlink" title="创建docker-compose.yml"></a>创建docker-compose.yml</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /data/rabbitmq/docker-compose.yml</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">rabbitmq:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">rabbitmq:3.12.12-management</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">RABBITMQ_DEFAULT_PASS=root</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">RABBITMQ_DEFAULT_USER=root</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/rabbitmq/plugins:/plugins</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="number">5672</span><span class="string">:5672</span></span><br><span class="line">            <span class="bullet">-</span> <span class="number">15672</span><span class="string">:15672</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">rabbitmq_net</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">rabbitmq</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">rabbitmq</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">    <span class="attr">rabbitmq_net:</span> </span><br><span class="line">        <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></table></figure>

<h3 id="启动容器-6"><a href="#启动容器-6" class="headerlink" title="启动容器"></a>启动容器</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<h2 id="RocketMQ"><a href="#RocketMQ" class="headerlink" title="RocketMQ"></a>RocketMQ</h2><blockquote>
<p>访问页面: <a href="http://ip:8180/">http://ip:8180</a></p>
</blockquote>
<h3 id="创建挂载的目录-7"><a href="#创建挂载的目录-7" class="headerlink" title="创建挂载的目录"></a>创建挂载的目录</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p /data/rocketmq/namesrv</span><br><span class="line">mkdir -p /data/rocketmq/console/data</span><br><span class="line">mkdir -p /data/rocketmq/broker/&#123;conf,lib&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建Broker配置文件"><a href="#创建Broker配置文件" class="headerlink" title="创建Broker配置文件"></a>创建Broker配置文件</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /data/rocketmq/broker/conf/broker.conf</span><br></pre></td></tr></table></figure>

<p>记得修改brokerIP1为宿主机地址</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#所属集群名字</span><br><span class="line">brokerClusterName=DefaultCluster</span><br><span class="line"></span><br><span class="line">#broker名字,注意此处不同的配置文件填写的不一样,如果在broker-a.properties使用:broker-a,在broker-b.properties使用:broker-b</span><br><span class="line">brokerName=broker-a</span><br><span class="line"></span><br><span class="line">#0:表示Master &gt;0:表示Slave</span><br><span class="line">brokerId=0</span><br><span class="line"></span><br><span class="line">#nameServer地址,分号分割</span><br><span class="line">#namesrvAddr=rocketmq-nameserver1:9876;rocketmq-nameserver2:9876</span><br><span class="line">namesrvAddr=rocketmq-namesrv:9876</span><br><span class="line"></span><br><span class="line">#启动IP,如果docker报com.alibaba.rocketmq.remoting.exception.RemotingConnectException: connect to &lt;192.168.0.120:10909&gt; failed</span><br><span class="line">#解决方式1:加上一句producer.setVipChannelEnabled(false);</span><br><span class="line">#解决方式2:brokerIP1设置宿主机IP,不要使用docker内部IP</span><br><span class="line">brokerIP1=ip</span><br><span class="line"></span><br><span class="line">#在发送消息时,自动创建服务器不存在的topic,默认创建的队列数</span><br><span class="line">defaultTopicQueueNums=4</span><br><span class="line"></span><br><span class="line">#是否允许Broker自动创建Topic,建议线下开启,线上关闭</span><br><span class="line">autoCreateTopicEnable=true</span><br><span class="line"></span><br><span class="line">#是否允许Broker自动创建订阅组,建议线下开启,线上关闭</span><br><span class="line">autoCreateSubscriptionGroup=true</span><br><span class="line"></span><br><span class="line">#Broker对外服务的监听端口</span><br><span class="line">listenPort=10911</span><br><span class="line"></span><br><span class="line">#此参数控制是否开启密码,不开启可设置false</span><br><span class="line">aclEnable=true</span><br><span class="line"></span><br><span class="line">#删除文件时间点,默认凌晨4点</span><br><span class="line">deleteWhen=04</span><br><span class="line"></span><br><span class="line">#文件保留时间,默认48小时</span><br><span class="line">fileReservedTime=120</span><br><span class="line"></span><br><span class="line">#commitLog每个文件的大小默认1G</span><br><span class="line">mapedFileSizeCommitLog=1073741824</span><br><span class="line"></span><br><span class="line">#ConsumeQueue每个文件默认存30W条,根据业务情况调整</span><br><span class="line">mapedFileSizeConsumeQueue=300000</span><br><span class="line"></span><br><span class="line">#destroyMapedFileIntervalForcibly=120000</span><br><span class="line">#redeleteHangedFileInterval=120000</span><br><span class="line">#检测物理文件磁盘空间</span><br><span class="line">diskMaxUsedSpaceRatio=88</span><br><span class="line">#存储路径</span><br><span class="line">#storePathRootDir=/home/ztztdata/rocketmq-all-4.1.0-incubating/store</span><br><span class="line">#commitLog 存储路径</span><br><span class="line">#storePathCommitLog=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/commitlog</span><br><span class="line">#消费队列存储</span><br><span class="line">#storePathConsumeQueue=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/consumequeue</span><br><span class="line">#消息索引存储路径</span><br><span class="line">#storePathIndex=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/index</span><br><span class="line">#checkpoint 文件存储路径</span><br><span class="line">#storeCheckpoint=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/checkpoint</span><br><span class="line">#abort 文件存储路径</span><br><span class="line">#abortFile=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/abort</span><br><span class="line">#限制的消息大小</span><br><span class="line">maxMessageSize=65536</span><br><span class="line"></span><br><span class="line">#flushCommitLogLeastPages=4</span><br><span class="line">#flushConsumeQueueLeastPages=2</span><br><span class="line">#flushCommitLogThoroughInterval=10000</span><br><span class="line">#flushConsumeQueueThoroughInterval=60000</span><br><span class="line"></span><br><span class="line">#Broker的角色</span><br><span class="line">#- ASYNC_MASTER 异步复制Master</span><br><span class="line">#- SYNC_MASTER 同步双写Master</span><br><span class="line">#- SLAVE</span><br><span class="line">brokerRole=ASYNC_MASTER</span><br><span class="line"></span><br><span class="line">#刷盘方式</span><br><span class="line">#- ASYNC_FLUSH 异步刷盘</span><br><span class="line">#- SYNC_FLUSH 同步刷盘</span><br><span class="line">flushDiskType=ASYNC_FLUSH</span><br><span class="line"></span><br><span class="line">#发消息线程池数量</span><br><span class="line">#sendMessageThreadPoolNums=128</span><br><span class="line">#拉消息线程池数量</span><br><span class="line">#pullMessageThreadPoolNums=128</span><br></pre></td></tr></table></figure>

<h3 id="创建Acl配置文件"><a href="#创建Acl配置文件" class="headerlink" title="创建Acl配置文件"></a>创建Acl配置文件</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /data/rocketmq/broker/conf/plain_acl.yml</span><br></pre></td></tr></table></figure>

<p>accessKey和secretKey需要大于6位</p>
 <figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#全局白名单,如果配置了则不需要走acl校验,慎重配置</span></span><br><span class="line"><span class="attr">globalWhiteRemoteAddresses:</span></span><br><span class="line"><span class="comment"># - 47.100.93.*</span></span><br><span class="line"><span class="comment"># - 156.254.120.*</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">accounts:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">accessKey:</span> <span class="string">rocketmquser</span></span><br><span class="line">    <span class="attr">secretKey:</span> <span class="number">12345678</span></span><br><span class="line">    <span class="attr">whiteRemoteAddress:</span></span><br><span class="line">    <span class="attr">admin:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">defaultTopicPerm:</span> <span class="string">DENY</span></span><br><span class="line">    <span class="attr">defaultGroupPerm:</span> <span class="string">SUB</span></span><br><span class="line">    <span class="attr">topicPerms:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">topicA=DENY</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">topicB=PUB|SUB</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">topicC=SUB</span></span><br><span class="line">    <span class="attr">groupPerms:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">groupA=DENY</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">groupB=PUB|SUB</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">groupC=SUB</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">accessKey:</span> <span class="string">rocketmqadmin</span></span><br><span class="line">    <span class="attr">secretKey:</span> <span class="number">12345678</span></span><br><span class="line">    <span class="attr">whiteRemoteAddress:</span> </span><br><span class="line">    <span class="attr">admin:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="创建Console配置文件"><a href="#创建Console配置文件" class="headerlink" title="创建Console配置文件"></a>创建Console配置文件</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /data/rocketmq/console/data/users.properties</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#用户名和密码规则「用户名=密码,权限」1:管理员 0:普通用户</span><br><span class="line">admin=123456,1</span><br></pre></td></tr></table></figure>

<h3 id="创建docker-compose-yml-7"><a href="#创建docker-compose-yml-7" class="headerlink" title="创建docker-compose.yml"></a>创建docker-compose.yml</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /data/rocketmq/docker-compose.yml</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">rocketmq-namesrv:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">foxiswho/rocketmq:4.8.0</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">        <span class="attr">command:</span> [ <span class="string">&quot;sh&quot;</span>, <span class="string">&quot;mqnamesrv&quot;</span> ]</span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="attr">JAVA_OPT_EXT:</span> <span class="string">&quot;-Duser.home=/home/rocketmq -Xms128M -Xmx128M -Xmn128m&quot;</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/rocketmq/namesrv/logs:/home/rocketmq/logs</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/rocketmq/namesrv/store:/home/rocketmq/store</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="number">9876</span><span class="string">:9876</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="attr">rocketmq_net:</span></span><br><span class="line">                <span class="attr">aliases:</span></span><br><span class="line">                    <span class="bullet">-</span> <span class="string">rocketmq-namesrv</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">rocketmq-namesrv</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">rocketmq-namesrv</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">rocketmq-broker:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">foxiswho/rocketmq:4.8.0</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">        <span class="attr">command:</span> [ <span class="string">&quot;sh&quot;</span>, <span class="string">&quot;mqbroker&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;/etc/rocketmq/broker.conf&quot;</span> ]</span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="attr">JAVA_OPT_EXT:</span> <span class="string">&quot;-Duser.home=/home/rocketmq -Xms128m -Xmx128m -Xmn128m&quot;</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/rocketmq/broker/logs:/home/rocketmq/logs</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/rocketmq/broker/store:/home/rocketmq/store</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/rocketmq/broker/conf/plain_acl.yml:/home/rocketmq/rocketmq-4.8.0/conf/plain_acl.yml</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/rocketmq/broker/conf/broker.conf:/etc/rocketmq/broker.conf</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="number">10909</span><span class="string">:10909</span></span><br><span class="line">            <span class="bullet">-</span> <span class="number">10911</span><span class="string">:10911</span></span><br><span class="line">        <span class="attr">depends_on:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">rocketmq-namesrv</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="attr">rocketmq_net:</span></span><br><span class="line">                <span class="attr">aliases:</span></span><br><span class="line">                    <span class="bullet">-</span> <span class="string">rocketmq-broker</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">rocketmq-broker</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">rocketmq-broker</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">rocketmq-console:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">iamverygood/rocketmq-console:4.7.1</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="attr">JAVA_OPTS:</span> <span class="string">&quot;-Drocketmq.namesrv.addr=rocketmq-namesrv:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false -Drocketmq.config.loginRequired=true -Drocketmq.config.aclEnabled=true -Duser.timezone=&#x27;Asia/Shanghai&#x27; -Drocketmq.config.accessKey=rocketmqadmin -Drocketmq.config.secretKey=12345678&quot;</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/rocketmq/console/data:/tmp/rocketmq-console/data</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="number">8180</span><span class="string">:8080</span></span><br><span class="line">        <span class="attr">depends_on:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">rocketmq-namesrv</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="attr">rocketmq_net:</span></span><br><span class="line">                <span class="attr">aliases:</span></span><br><span class="line">                    <span class="bullet">-</span> <span class="string">rocketmq-console</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">rocketmq-console</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">rocketmq-console</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">    <span class="attr">rocketmq_net:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">rocketmq_net</span></span><br><span class="line">        <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></table></figure>

<p>如果你的acl密码改了,记得把yml里的console帐号密码也一同更改</p>
<h3 id="授予目录权限"><a href="#授予目录权限" class="headerlink" title="授予目录权限"></a>授予目录权限</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod -R 777 /data/rocketmq/namesrv/</span><br><span class="line">chmod -R 777 /data/rocketmq/broker/</span><br><span class="line">chmod -R 777 /data/rocketmq/console/</span><br></pre></td></tr></table></figure>

<h3 id="启动容器-7"><a href="#启动容器-7" class="headerlink" title="启动容器"></a>启动容器</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<p>注意,如果第一次启动不成功,是因为broker需要创建一堆文件,没有权限,再执行一遍权限命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod -R 777 /data/rocketmq/namesrv/</span><br><span class="line">chmod -R 777 /data/rocketmq/broker/</span><br><span class="line">chmod -R 777 /data/rocketmq/console/</span><br><span class="line"></span><br><span class="line">docker-compose up --force-recreate -d</span><br></pre></td></tr></table></figure>

<h2 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h2><blockquote>
<p>访问页面: <a href="http://ip:9001/">http://ip:9001</a></p>
</blockquote>
<h3 id="创建挂载的目录-8"><a href="#创建挂载的目录-8" class="headerlink" title="创建挂载的目录"></a>创建挂载的目录</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p /data/zookeeper/&#123;data,conf,logs&#125;</span><br><span class="line">mkdir -p /data/kafka/kafka-map/data</span><br></pre></td></tr></table></figure>

<h3 id="创建挂载的配置文件-4"><a href="#创建挂载的配置文件-4" class="headerlink" title="创建挂载的配置文件"></a>创建挂载的配置文件</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /data/zookeeper/conf/zoo.cfg</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#数据目录</span><br><span class="line">dataDir=/data</span><br><span class="line"></span><br><span class="line">#事务日志目录</span><br><span class="line">dataLogDir=/datalog</span><br><span class="line"></span><br><span class="line">#控制超时和计时</span><br><span class="line">tickTime=2000</span><br><span class="line"></span><br><span class="line">#初始化连接限制时间</span><br><span class="line">initLimit=5</span><br><span class="line"></span><br><span class="line">#同步限制时间</span><br><span class="line">syncLimit=2</span><br><span class="line"></span><br><span class="line">#自动清理快照文件的保留数量</span><br><span class="line">autopurge.snapRetainCount=3</span><br><span class="line"></span><br><span class="line">#自动清理快照文件的时间间隔(设置为0表示禁用自动清理)</span><br><span class="line">autopurge.purgeInterval=0</span><br><span class="line"></span><br><span class="line">#允许的最大客户端连接数</span><br><span class="line">maxClientCnxns=60</span><br><span class="line"></span><br><span class="line">#单机版模式开启</span><br><span class="line">standaloneEnabled=true</span><br><span class="line"></span><br><span class="line">#启用Zookeeper服务器的管理界面</span><br><span class="line">admin.enableServer=true</span><br><span class="line"></span><br><span class="line">#Zookeeper服务器的配置</span><br><span class="line">server.1=localhost:2888:3888;2181</span><br></pre></td></tr></table></figure>

<h3 id="创建docker-compose-yml-8"><a href="#创建docker-compose-yml-8" class="headerlink" title="创建docker-compose.yml"></a>创建docker-compose.yml</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /data/kafka/docker-compose.yml</span><br></pre></td></tr></table></figure>

<p>记得修改kafka-server为宿主机地址</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">zookeeper:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">zookeeper</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/zookeeper/data:/data</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/zookeeper/conf:/conf</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/zookeeper/logs:/datalog</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="number">2181</span><span class="string">:2181</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">kafka_net</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">zookeeper</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">zookeeper</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">kafka-server:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">bitnami/kafka</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">ALLOW_PLAINTEXT_LISTENER=yes</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper:2181</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://ip:9092</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="number">9092</span><span class="string">:9092</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">kafka_net</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">kafka-server</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">kafka-server</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">kafka-map:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">dushixiang/kafka-map</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">DEFAULT_USERNAME=root</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">DEFAULT_PASSWORD=root</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/kafka/kafka-map/data:/usr/local/kafka-map/data</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="number">9001</span><span class="string">:8080</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">kafka_net</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">kafka-map</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">kafka-map</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">    <span class="attr">kafka_net:</span></span><br><span class="line">        <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></table></figure>

<h3 id="启动容器-8"><a href="#启动容器-8" class="headerlink" title="启动容器"></a>启动容器</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
        <tag>中间件</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot封装统一返回体</title>
    <url>/posts/15647.html</url>
    <content><![CDATA[<h2 id="枚举类"><a href="#枚举类" class="headerlink" title="枚举类"></a>枚举类</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">ResultCodeEnum</span> &#123;</span><br><span class="line"></span><br><span class="line">    SUCCESS(<span class="number">200</span>, <span class="string">&quot;操作成功&quot;</span>),</span><br><span class="line">    USER_ERROR(<span class="number">400</span>, <span class="string">&quot;操作错误&quot;</span>),</span><br><span class="line">    SYSTEM_ERROR(<span class="number">500</span>, <span class="string">&quot;系统错误&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String msg;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="通用返回体"><a href="#通用返回体" class="headerlink" title="通用返回体"></a>通用返回体</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Serial</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">ok</span><span class="params">()</span> &#123;</span><br><span class="line">        Result&lt;T&gt; result = <span class="keyword">new</span> <span class="title class_">Result</span>&lt;T&gt;();</span><br><span class="line">        result.setCode(ResultCodeEnum.SUCCESS.getCode());</span><br><span class="line">        result.setMsg(ResultCodeEnum.SUCCESS.getMsg());</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">ok</span><span class="params">(T data)</span> &#123;</span><br><span class="line">        Result&lt;T&gt; result = <span class="keyword">new</span> <span class="title class_">Result</span>&lt;T&gt;();</span><br><span class="line">        result.setCode(ResultCodeEnum.SUCCESS.getCode());</span><br><span class="line">        result.setMsg(ResultCodeEnum.SUCCESS.getMsg());</span><br><span class="line">        result.setData(data);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">ok</span><span class="params">(ResultCodeEnum resultCode)</span> &#123;</span><br><span class="line">        Result&lt;T&gt; result = <span class="keyword">new</span> <span class="title class_">Result</span>&lt;T&gt;();</span><br><span class="line">        result.setCode(resultCode.getCode());</span><br><span class="line">        result.setMsg(resultCode.getMsg());</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">ok</span><span class="params">(ResultCodeEnum resultCode, String msg)</span> &#123;</span><br><span class="line">        Result&lt;T&gt; result = <span class="keyword">new</span> <span class="title class_">Result</span>&lt;T&gt;();</span><br><span class="line">        result.setCode(resultCode.getCode());</span><br><span class="line">        result.setMsg(msg);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">ok</span><span class="params">(ResultCodeEnum resultCode, T data)</span> &#123;</span><br><span class="line">        Result&lt;T&gt; result = <span class="keyword">new</span> <span class="title class_">Result</span>&lt;T&gt;();</span><br><span class="line">        result.setCode(resultCode.getCode());</span><br><span class="line">        result.setMsg(resultCode.getMsg());</span><br><span class="line">        result.setData(data);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">fail</span><span class="params">()</span> &#123;</span><br><span class="line">        Result&lt;T&gt; result = <span class="keyword">new</span> <span class="title class_">Result</span>&lt;T&gt;();</span><br><span class="line">        result.setCode(ResultCodeEnum.USER_ERROR.getCode());</span><br><span class="line">        result.setMsg(ResultCodeEnum.USER_ERROR.getMsg());</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">fail</span><span class="params">(T data)</span> &#123;</span><br><span class="line">        Result&lt;T&gt; result = <span class="keyword">new</span> <span class="title class_">Result</span>&lt;T&gt;();</span><br><span class="line">        result.setCode(ResultCodeEnum.USER_ERROR.getCode());</span><br><span class="line">        result.setMsg(ResultCodeEnum.USER_ERROR.getMsg());</span><br><span class="line">        result.setData(data);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">fail</span><span class="params">(ResultCodeEnum resultCode)</span> &#123;</span><br><span class="line">        Result&lt;T&gt; result = <span class="keyword">new</span> <span class="title class_">Result</span>&lt;T&gt;();</span><br><span class="line">        result.setCode(resultCode.getCode());</span><br><span class="line">        result.setMsg(resultCode.getMsg());</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">fail</span><span class="params">(ResultCodeEnum resultCode, String msg)</span> &#123;</span><br><span class="line">        Result&lt;T&gt; result = <span class="keyword">new</span> <span class="title class_">Result</span>&lt;T&gt;();</span><br><span class="line">        result.setCode(resultCode.getCode());</span><br><span class="line">        result.setMsg(msg);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">fail</span><span class="params">(ResultCodeEnum resultCode, T data)</span> &#123;</span><br><span class="line">        Result&lt;T&gt; result = <span class="keyword">new</span> <span class="title class_">Result</span>&lt;T&gt;();</span><br><span class="line">        result.setCode(resultCode.getCode());</span><br><span class="line">        result.setMsg(resultCode.getMsg());</span><br><span class="line">        result.setData(data);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="分页返回体"><a href="#分页返回体" class="headerlink" title="分页返回体"></a>分页返回体</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageResult</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Serial</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long totalPages;</span><br><span class="line">    <span class="keyword">private</span> Integer pageNo;</span><br><span class="line">    <span class="keyword">private</span> Long totalRecords;</span><br><span class="line">    <span class="keyword">private</span> Integer pageSize;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Boolean</span> <span class="variable">isLast</span> <span class="operator">=</span> Boolean.FALSE;</span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; list;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; PageResult&lt;T&gt; <span class="title function_">empty</span><span class="params">()</span> &#123;</span><br><span class="line">        PageResult&lt;T&gt; r = <span class="keyword">new</span> <span class="title class_">PageResult</span>&lt;&gt;();</span><br><span class="line">        r.setTotalPages(<span class="number">1L</span>);</span><br><span class="line">        r.setPageNo(<span class="number">1</span>);</span><br><span class="line">        r.setTotalRecords(<span class="number">0L</span>);</span><br><span class="line">        r.setPageSize(<span class="number">0</span>);</span><br><span class="line">        r.setIsLast(<span class="literal">true</span>);</span><br><span class="line">        r.setList(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; PageResult&lt;T&gt; <span class="title function_">init</span><span class="params">(Long totalPages, Integer pageNo, Long totalRecords, Integer pageSize, Boolean isLast, List&lt;T&gt; list)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>&lt;T&gt;(totalPages, pageNo, totalRecords, pageSize, isLast, list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; PageResult&lt;T&gt; <span class="title function_">init</span><span class="params">(Long totalPages, Integer pageNo, Long totalRecords, Integer pageSize, List&lt;T&gt; list)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>&lt;T&gt;(totalPages, pageNo, totalRecords, pageSize, isLastPage(pageNo, totalRecords, pageSize), list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title function_">isLastPage</span><span class="params">(Integer pageNo, Long totalRecords, Integer pageSize)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (pageSize == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">pageTotal</span> <span class="operator">=</span> totalRecords / pageSize + (totalRecords % pageSize == <span class="number">0</span> ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> pageNo &gt;= pageTotal;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
</search>
